{% extends "base.html" %}
{% load humanize %}
{% block content %}
<h2>{{ doc.original_filename }} ({{ doc.year }}, {{ doc.get_doc_type_display }})</h2>

<p>
  <a class="btn btn-secondary" href="{% url 'ingestion:documents' %}">← Zpět</a>
  <a class="btn btn-danger" href="{% url 'ingestion:delete_document' doc.id %}">Smazat dokument</a>
</p>

<h4>Normalizovaná data (per kód)</h4>
<table class="table table-bordered">
  <thead><tr><th>Kód</th><th>Položka</th><th class="text-end">Hodnota</th></tr></thead>
  <tbody>
    {% for m in metrics_base %}
      <tr>
        <td>{{ m.code }}</td>
        <td>{{ m.label }}</td>
        <td class="text-end">{% if m.value is not None %}{{ m.value|floatformat:0|intcomma }}{% endif %}</td>
      </tr>
    {% empty %}
      <tr><td colspan="3" class="text-center text-muted">Žádná data</td></tr>
    {% endfor %}
  </tbody>
</table>

<h4>Dopočítané metriky</h4>
<table class="table table-bordered">
  <thead><tr><th>Klíč</th><th class="text-end">Hodnota</th></tr></thead>
  <tbody>
    {% for m in metrics_derived %}
      <tr>
        <td>{{ m.derived_key }}</td>
        <td class="text-end">{% if m.value is not None %}{{ m.value|floatformat:0|intcomma }}{% endif %}</td>
      </tr>
    {% empty %}
      <tr><td colspan="2" class="text-center text-muted">Žádné dopočty</td></tr>
    {% endfor %}
  </tbody>
</table>

<h4>Raw řádky (audit)</h4>
<table class="table table-sm table-striped">
  <thead><tr><th>#</th><th>Kód</th><th>Položka</th><th class="text-end">Hodnota</th></tr></thead>
  <tbody>
    {% for r in rows %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ r.code }}</td>
        <td>{{ r.label }}</td>
        <td class="text-end">{% if r.value is not None %}{{ r.value|floatformat:0|intcomma }}{% endif %}</td>
      </tr>
    {% empty %}
      <tr><td colspan="4" class="text-center text-muted">Žádná data</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
