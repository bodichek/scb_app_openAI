{% extends "base.html" %}
{% load static %}
{% block content %}
<h2>ğŸ“Š Dashboard (BI)</h2>

<!-- VÃ½bÄ›r roku -->
<form method="get" class="mb-4">
  <label for="yearSelect"><strong>Vyber rok pro rozvahu:</strong></label>
  <select name="year" id="yearSelect" class="form-select" style="max-width:200px; display:inline-block;">
    {% for y in years %}
      <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
    {% endfor %}
  </select>
  <button type="submit" class="btn btn-primary btn-sm">Zobrazit</button>
</form>

<h3>VÃ½voj v Äase (vÃ½sledovka)</h3>
<canvas id="incomeChart"></canvas>

<h3 class="mt-4">Rozvaha â€“ aktiva ({{ selected_year }})</h3>
<canvas id="assetsPie"></canvas>

<h3 class="mt-4">Rozvaha â€“ pasiva ({{ selected_year }})</h3>
<canvas id="liabilitiesPie"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // --- Income line chart ---
  const years = {{ years|safe }};
  const revenue = {{ income_series.revenue|safe }};
  const ebit = {{ income_series.ebit|safe }};
  const net = {{ income_series.net_profit|safe }};

  new Chart(document.getElementById("incomeChart"), {
    type: 'line',
    data: {
      labels: years,
      datasets: [
        { label: "Revenue", data: revenue, borderColor: "blue", fill: false },
        { label: "EBIT", data: ebit, borderColor: "green", fill: false },
        { label: "Net Profit", data: net, borderColor: "red", fill: false },
      ]
    }
  });

  // --- Balance pie charts ---
  const assets = {{ balance_assets|safe }};
  const liabilities = {{ balance_liabilities|safe }};

  new Chart(document.getElementById("assetsPie"), {
    type: 'pie',
    data: {
      labels: assets.map(a => a.label),
      datasets: [{ data: assets.map(a => a.value), backgroundColor: ["#4e79a7","#f28e2b","#e15759","#76b7b2","#59a14f"] }]
    }
  });

  new Chart(document.getElementById("liabilitiesPie"), {
    type: 'pie',
    data: {
      labels: liabilities.map(a => a.label),
      datasets: [{ data: liabilities.map(a => a.value), backgroundColor: ["#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"] }]
    }
  });
</script>
{% endblock %}
