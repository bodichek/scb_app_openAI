{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container">
  <h2>üìä Profitability Dashboard</h2>

  <!-- üîπ Hlavn√≠ metriky -->
  <div class="mb-5">
    <h4>Hlavn√≠ metriky</h4>
    <canvas id="mainMetricsChart" height="120"></canvas>
  </div>

  <!-- üîπ Mar≈æe v % (line) -->
  <div class="mb-5">
    <h4>Mar≈æe (%) ‚Äì v√Ωvoj</h4>
    <canvas id="marginsChart" height="120"></canvas>
  </div>

  <!-- üîπ Mar≈æe v % (bar) -->
  <div class="mb-5">
    <h4>Mar≈æe (%) ‚Äì srovn√°n√≠</h4>
    <canvas id="marginsBarChart" height="120"></canvas>
  </div>

  <!-- üîπ Cash Flow -->
  <div class="mb-5">
    <h4>Cash Flow</h4>
    <canvas id="cashFlowChart" height="120"></canvas>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const years = {{ years_list|safe }};

  // --- Hlavn√≠ metriky ---
  new Chart(document.getElementById('mainMetricsChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: years,
      datasets: [
        { label: 'Revenue', data: {{ revenue_list|safe }}, backgroundColor: 'rgba(54, 162, 235, 0.7)' },
        { label: 'COGS', data: {{ cogs_list|safe }}, backgroundColor: 'rgba(255, 99, 132, 0.7)' },
        { label: 'Gross Margin', data: {{ gross_margin_list|safe }}, backgroundColor: 'rgba(75, 192, 192, 0.7)' },
        { label: 'Overheads', data: {{ overheads_list|safe }}, backgroundColor: 'rgba(255, 206, 86, 0.7)' },
        { label: 'EBIT', data: {{ ebit_list|safe }}, backgroundColor: 'rgba(153, 102, 255, 0.7)' },
        { label: 'Net Profit', data: {{ net_profit_list|safe }}, backgroundColor: 'rgba(201, 203, 207, 0.7)' }
      ]
    },
    options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
  });

  // --- Mar≈æe (line) ---
  new Chart(document.getElementById('marginsChart').getContext('2d'), {
    type: 'line',
    data: {
      labels: years,
      datasets: [
        { label: 'Gross Margin %', data: {{ gross_margin_pct_list|safe }}, borderColor: 'rgba(75, 192, 192, 1)', tension: 0.3, fill: true },
        { label: 'EBIT Margin %', data: {{ operating_profit_pct_list|safe }}, borderColor: 'rgba(153, 102, 255, 1)', tension: 0.3, fill: true },
        { label: 'Net Profit %', data: {{ net_profit_pct_list|safe }}, borderColor: 'rgba(255, 159, 64, 1)', tension: 0.3, fill: true }
      ]
    },
    options: { responsive: true, plugins: { legend: { position: 'bottom' } }, scales: { y: { beginAtZero: true, max: 100 } } }
  });

  // --- Mar≈æe (bar) ---
  new Chart(document.getElementById('marginsBarChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: years,
      datasets: [
        { label: 'Gross Margin %', data: {{ gross_margin_pct_list|safe }}, backgroundColor: 'rgba(75, 192, 192, 0.7)' },
        { label: 'EBIT Margin %', data: {{ operating_profit_pct_list|safe }}, backgroundColor: 'rgba(153, 102, 255, 0.7)' },
        { label: 'Net Profit %', data: {{ net_profit_pct_list|safe }}, backgroundColor: 'rgba(255, 159, 64, 0.7)' }
      ]
    },
    options: { responsive: true, plugins: { legend: { position: 'bottom' } }, scales: { y: { beginAtZero: true, max: 100 } } }
  });

  // --- Cash Flow ---
  new Chart(document.getElementById('cashFlowChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: years,
      datasets: [
        { label: 'Operating CF (OCF)', data: {{ ocf_list|safe }}, backgroundColor: 'rgba(54, 162, 235, 0.7)' },
        { label: 'Cash from Customers', data: {{ cash_from_customers_list|safe }}, backgroundColor: 'rgba(75, 192, 192, 0.7)' },
        { label: 'Cash to Suppliers', data: {{ cash_to_suppliers_list|safe }}, backgroundColor: 'rgba(255, 99, 132, 0.7)' }
      ]
    },
    options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
  });
</script>
{% endblock %}
